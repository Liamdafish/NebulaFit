<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today | Astronaut Fitness Tracker</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

  <style>
    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .content {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <nav class="tabbar">
    <!-- Add navigation links here -->
  </nav>

  <div class="content">
    <header>
      <h1>Today</h1>
    </header>
    <main>
      <!-- Log Fitness Data -->
      <section>
        <h2>Log Food Data</h2>
        <div class="inputs">
          <div>
            <label for="foodSearch">Search for Food</label>
            <input id="foodSearch" type="text" placeholder="Search for food...">
          </div>
          <button id="searchFood" onclick="searchFood()">Search</button>
        </div>

        <div id="foodResults"></div>

        <button id="submitFood">Submit Food</button>
      </section>

      <!-- Fitness Logs Table -->
      <section>
        <h2>Fitness Logs</h2>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Food</th>
              <th>Calories</th>
              <th>Edit</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="logsSection"></tbody>
        </table>
      </section>
    </main>
  </div>

  <script>
    particlesJS('particles-js', {
      "particles": {
        "number": { "value": 80, "density": { "enable": true, "value_area": 800 }},
        "color": { "value": "#ffffff" },
        "shape": { "type": "circle", "stroke": { "width": 0 }},
        "size": { "value": 3, "random": true },
        "move": { "enable": true, "speed": 2, "direction": "none", "random": true, "out_mode": "out" }
      }
    });

    // Get the client ID and client secret from your FatSecret API credentials
    const clientId = 'YOUR_CLIENT_ID';
    const clientSecret = '5f42c2ac6ac8431db8b6511eac435aa3';

    // Function to get an access token (OAuth 2.0 Authentication)
    async function getAccessToken() {
      const response = await fetch('https://api.fatsecret.com/rest/server.api', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
          'grant_type': 'client_credentials',
          'client_id': clientId,
          'client_secret': clientSecret
        })
      });
      const data = await response.json();
      return data.access_token;
    }

    // Function to search food
    async function searchFood() {
      const searchQuery = document.getElementById('foodSearch').value;
      if (!searchQuery) {
        alert('Please enter a food item to search for.');
        return;
      }

      const accessToken = await getAccessToken();
      const response = await fetch(`https://platform.fatsecret.com/rest/server.api?method=foods.search&search_expression=${searchQuery}&access_token=${accessToken}`);
      const data = await response.json();

      const foodResults = data.foods.food.map(food => {
        return `
          <div class="food-item">
            <h3>${food.food_name}</h3>
            <p>Calories: ${food.nutritional_contents ? food.nutritional_contents.calories : 'N/A'} kcal</p>
            <button onclick="addFoodToLog('${food.food_name}', ${food.nutritional_contents ? food.nutritional_contents.calories : 0})">Add to Log</button>
          </div>
        `;
      }).join('');
      document.getElementById('foodResults').innerHTML = foodResults;
    }

    // Function to add food to the log
    function addFoodToLog(foodName, calories) {
      const logRow = document.createElement('tr');
      logRow.innerHTML = `
        <td>${new Date().toLocaleDateString()}</td>
        <td>${foodName}</td>
        <td>${calories}</td>
        <td><button onclick="editRow(this)">Edit</button></td>
        <td><button onclick="deleteRow(this)">Delete</button></td>
      `;
      document.getElementById('logsSection').appendChild(logRow);
    }

    // Function to delete a row
    function deleteRow(button) {
      const row = button.closest('tr');
      row.remove();
    }

    // Function to edit a row (expandable based on your use case)
    function editRow(button) {
      alert('Edit functionality to be implemented');
    }
  </script>
</body>
</html>
