<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today | Astronaut Fitness Tracker</title>
  <link rel="stylesheet" href="style.css">
  <!-- Font Awesome CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Particles.js Script -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <!-- Chart.js Script -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Particles Background -->
  <div id="particles-js"></div>

  <nav class="tabbar">
    <a class="tab-link" href="today.html">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"></path>
      </svg>
      <span>Today</span>
    </a>
  </nav>

  <div class="content">
    <header>
      <h1>Today</h1>
    </header>
    <main>
      <!-- Log Fitness Data -->
      <section>
        <h2>Log Fitness Data</h2>
        <div class="inputs">
          <div>
            <label for="steps">Steps</label>
            <input id="steps" type="number">
          </div>
          <div>
            <label for="water">Water Intake (L)</label>
            <input id="water" type="number" step="0.1">
          </div>
          <div>
            <label for="sleep">Sleep (Hours)</label>
            <input id="sleep" type="number" step="0.1">
          </div>
          <div>
            <label for="foodSearch">Search Food (e.g. Banana)</label>
            <input id="foodSearch" type="text" placeholder="Enter food">
            <button id="searchFood" onclick="searchFood()">Search</button>
          </div>
        </div>
        <button id="addToChart" onclick="addToChart()">Add to Charts</button>
      </section>

      <!-- Display Search Results -->
      <section>
        <h2>Search Results</h2>
        <ul id="searchResults"></ul>
      </section>

      <!-- Fitness Logs Table -->
      <section>
        <h2>Fitness Logs</h2>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Steps</th>
              <th>Water Intake (L)</th>
              <th>Sleep (Hours)</th>
              <th>Food</th>
              <th>Calories</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="logsSection">
            <!-- Logs will be dynamically injected here -->
          </tbody>
        </table>
      </section>

      <!-- Fitness Data Charts -->
      <section>
        <h2>Fitness Data Charts</h2>

        <h3>Steps, Water Intake, and Sleep</h3>
        <canvas id="fitnessDataChart" width="400" height="200"></canvas>

        <h3>Food and Calories</h3>
        <canvas id="foodDataChart" width="400" height="200"></canvas>
      </section>
    </main>
  </div>

  <!-- Particles.js Initialization -->
  <script>
    particlesJS('particles-js', {
      "particles": {
        "number": {
          "value": 80,
          "density": {
            "enable": true,
            "value_area": 800  
          }
        },
        "color": {
          "value": "#ffffff"  
        },
        "shape": {
          "type": "circle",  
          "stroke": {
            "width": 0, 
            "color": "#000000"
          }
        },
        "size": {
          "value": 3,  
          "random": true
        },
        "move": {
          "enable": true,
          "speed": 2,
          "direction": "none",  
          "random": true,
          "out_mode": "out"
        }
      }
    });
  </script>

  <!-- JS Script for Search, Logging and Charts -->
  <script>
    const apiKey = 'b86ae26b7f844ead91ce96df1eb8df0c';
    const logsSection = document.getElementById('logsSection');
    const searchResults = document.getElementById('searchResults');
    const fitnessDataChartCtx = document.getElementById('fitnessDataChart').getContext('2d');
    const foodDataChartCtx = document.getElementById('foodDataChart').getContext('2d');
    
    // Chart for Fitness Data (Steps, Water, Sleep)
    let fitnessDataChart = new Chart(fitnessDataChartCtx, {
      type: 'bar',
      data: {
        labels: ['Steps', 'Water', 'Sleep'],
        datasets: [{
          label: 'Today\'s Fitness Data',
          data: [0, 0, 0],  // Default values for steps, water, sleep
          backgroundColor: [
            'rgba(75, 192, 192, 0.2)', 
            'rgba(153, 102, 255, 0.2)', 
            'rgba(255, 159, 64, 0.2)'
          ],
          borderColor: [
            'rgba(75, 192, 192, 1)', 
            'rgba(153, 102, 255, 1)', 
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Chart for Food Data (Calories)
    let foodDataChart = new Chart(foodDataChartCtx, {
      type: 'pie',
      data: {
        labels: [],
        datasets: [{
          label: 'Food Caloric Information',
          data: [],  // Calories from food
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)', 
            'rgba(54, 162, 235, 0.2)', 
            'rgba(255, 206, 86, 0.2)', 
            'rgba(75, 192, 192, 0.2)', 
            'rgba(153, 102, 255, 0.2)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)', 
            'rgba(54, 162, 235, 1)', 
            'rgba(255, 206, 86, 1)', 
            'rgba(75, 192, 192, 1)', 
            'rgba(153, 102, 255, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

    // Function to search for food ingredients using the Spoonacular API
    async function searchFood() {
      const foodQuery = document.getElementById('foodSearch').value;
      const response = await fetch(`https://api.spoonacular.com/food/ingredients/search?query=${foodQuery}&number=1&apiKey=${apiKey}`);
      const data = await response.json();
      const result = data.ingredients[0];  // Grab first result (you can adjust for multiple)

      const foodName = result.name;
      const calories = result.nutrition.nutrients.find(nutrient => nutrient.title === 'Calories').amount;
      
      // Display the search result
      searchResults.innerHTML = `
        <li>${foodName} - ${calories} kcal</li>
      `;

      // Update food data chart with calories
      foodDataChart.data.labels.push(foodName);
      foodDataChart.data.datasets[0].data.push(calories);
      foodDataChart.update();
    }

    // Function to add data to both charts
    function addToChart() {
      const steps = document.getElementById('steps').value || 0;
      const water = document.getElementById('water').value || 0;
      const sleep = document.getElementById('sleep').value || 0;

      // Update fitness chart with new data
      fitnessDataChart.data.datasets[0].data = [steps, water, sleep];
      fitnessDataChart.update();
    }
  </script>
</body>
</html>
