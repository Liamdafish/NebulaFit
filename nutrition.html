<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nutrition | Astronaut Fitness Tracker</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Styling for the particles background */
    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    /* Content styles */
    .content {
      position: relative;
      z-index: 1;
      padding-left: 270px;
      padding-top: 60px;
    }

    /* Sidebar Styling */
    .tabbar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 250px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(12px);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 1rem 0;
    }

    .tabbar a {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      padding: 1rem;
      color: #bbb;
      transition: color 0.3s, background 0.3s;
    }

    .tabbar a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #81c7f5;
    }

    /* Nutrition search and options */
    .nutrition-search {
      margin: 1rem;
      text-align: center;
    }

    .nutrition-search input {
      padding: 10px;
      width: 80%;
      border-radius: 5px;
      border: none;
    }

    .nutrition-search ul {
      background-color: white;
      border: 1px solid #ccc;
      max-height: 150px;
      overflow-y: auto;
      margin: 0;
      padding: 0;
      list-style-type: none;
    }

    .nutrition-search li {
      padding: 8px;
      cursor: pointer;
    }

    .nutrition-search li:hover {
      background-color: #f0f0f0;
    }

    /* Nutrition Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      color: #fff;
    }

    table th, table td {
      padding: 8px 12px;
      text-align: center;
      border: 1px solid #ddd;
    }

    table th {
      background-color: #333;
      color: #fff;
    }

    table tbody tr:nth-child(even) {
      background-color: #444;
    }

    table tbody tr:nth-child(odd) {
      background-color: #333;
    }

    table th, table td {
      padding: 10px;
    }

    table th {
      text-transform: uppercase;
    }

    /* Chart container */
    .chart-container {
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
    }

    /* Image Styling */
    .food-image {
      max-width: 80px;
      max-height: 80px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <nav class="tabbar">
    <!-- Your existing navbar here -->
  </nav>

  <div class="content">
    <header>
      <h1>Nutrition Log</h1>
    </header>
    <main>
      <!-- Nutrition Search Section -->
      <section class="nutrition-search">
        <input type="text" id="food-search" placeholder="Search for food" oninput="getFoodSuggestions()" />
        <div id="food-suggestions"></div>
        <input type="number" id="serving-size" placeholder="Enter serving size" min="1" step="1" />
        <button onclick="searchFood()">Search</button>
      </section>

      <!-- Nutrition Data Table -->
      <section>
        <h2>Nutrition for the Day</h2>
        <table>
          <thead>
            <tr>
              <th>Food</th>
              <th>Calories</th>
              <th>Protein (g)</th>
              <th>Carbs (g)</th>
              <th>Fat (g)</th>
              <th>Timestamp</th>
              <th>Image</th>
            </tr>
          </thead>
          <tbody id="nutrition-table-body">
            <!-- Nutrition log will appear here -->
          </tbody>
        </table>
      </section>

      <!-- Nutrition Chart Section -->
      <section>
        <h2>Nutrition Breakdown</h2>
        <div class="chart-container">
          <canvas id="nutrition-chart"></canvas>
        </div>
      </section>
    </main>
  </div>

  <script>
    const API_ID = 'b0c02042';  // Your Application ID
    const API_KEY = 'c85342f02e2ce14196c6818dc0ec0d11';  // Your Application Key
    const nutritionTableBody = document.getElementById('nutrition-table-body');
    const foodSearchInput = document.getElementById('food-search');
    const servingSizeInput = document.getElementById('serving-size');
    const foodSuggestions = document.getElementById('food-suggestions');
    let nutritionData = [];
    let foodList = []; // To store food suggestions

    function getFoodSuggestions() {
      const query = foodSearchInput.value.trim();
      if (!query) {
        foodSuggestions.innerHTML = '';
        return;
      }

      const url = `https://api.edamam.com/api/food-database/v2/parser?app_id=${API_ID}&app_key=${API_KEY}&ingr=${query}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          foodList = data.hints || [];
          displayFoodSuggestions();
        });
    }

    function displayFoodSuggestions() {
      foodSuggestions.innerHTML = '';
      foodList.forEach(item => {
        const suggestion = document.createElement('li');
        suggestion.textContent = item.food.label;
        suggestion.onclick = () => {
          foodSearchInput.value = item.food.label;
          foodSuggestions.innerHTML = '';
        };
        foodSuggestions.appendChild(suggestion);
      });
    }

    function searchFood() {
      const foodQuery = foodSearchInput.value.trim();
      const servingSize = parseFloat(servingSizeInput.value) || 1;

      if (!foodQuery) {
        alert('Please enter a food item.');
        return;
      }

      const url = `https://api.edamam.com/api/food-database/v2/parser?app_id=${API_ID}&app_key=${API_KEY}&ingr=${foodQuery}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.hints && data.hints.length > 0) {
            displayNutritionData(data.hints[0].food, servingSize);
          } else {
            alert('No results found for this food.');
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          alert('Error fetching nutrition data.');
        });
    }

    function displayNutritionData(food, servingSize) {
      const foodName = food.label;
      const nutrition = food.nutrients;
      const timestamp = new Date().toLocaleString(); // Timestamp for the log
      const imageUrl = food.image || 'https://via.placeholder.com/80'; // Default image if not available

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${foodName}</td>
        <td>${(nutrition.ENERC_KCAL * servingSize).toFixed(2)}</td>
        <td>${(nutrition.PROCNT * servingSize).toFixed(2)}</td>
        <td>${(nutrition.CHOCDF * servingSize).toFixed(2)}</td>
        <td>${(nutrition.FAT * servingSize).toFixed(2)}</td>
        <td>${timestamp}</td>
        <td><img class="food-image" src="${imageUrl}" alt="${foodName} image" /></td>
      `;

      nutritionData.push({
        food: foodName,
        calories: nutrition.ENERC_KCAL * servingSize,
        protein: nutrition.PROCNT * servingSize,
        carbs: nutrition.CHOCDF * servingSize,
        fat: nutrition.FAT * servingSize,
        timestamp: timestamp
      });

      nutritionTableBody.appendChild(row);
      updateNutritionChart();
      saveDataToLocalStorage();
    }

    function updateNutritionChart() {
      const chartData = {
        labels: nutritionData.map(item => item.food),
        datasets: [{
          label: 'Calories',
          data: nutritionData.map(item => item.calories),
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }, {
          label: 'Protein',
          data: nutritionData.map(item => item.protein),
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }, {
          label: 'Carbs',
          data: nutritionData.map(item => item.carbs),
          backgroundColor: 'rgba(255, 159, 64, 0.2)',
          borderColor: 'rgba(255, 159, 64, 1)',
          borderWidth: 1
        }, {
          label: 'Fat',
          data: nutritionData.map(item => item.fat),
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      };

      const ctx = document.getElementById('nutrition-chart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
          scales: {
            x: { beginAtZero: true },
            y: { beginAtZero: true }
          }
        }
      });
    }

    function saveDataToLocalStorage() {
      localStorage.setItem('nutritionData', JSON.stringify(nutritionData));
    }

    function loadDataFromLocalStorage() {
      const storedData = localStorage.getItem('nutritionData');
      if (storedData) {
        nutritionData = JSON.parse(storedData);
        nutritionData.forEach(displayNutritionData);
      }
    }

    // Load saved data when the page is loaded
    window.onload = loadDataFromLocalStorage;
  </script>
</body>
</html>
